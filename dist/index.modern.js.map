{"version":3,"file":"index.modern.js","sources":["../src/little-h.js"],"sourcesContent":["let currentComponent = undefined;\nlet currentSlot = 0;\n\nexport const createElement = (\n  tag,\n  props = {},\n  ...children\n) => {\n  if (typeof tag === 'string') {\n    return createHtmlElement(tag, props, ...mapChildren(children));\n  } else {\n    return createComponentElement(tag, props, ...mapChildren(children));\n  }\n};\n\nexport const h = createElement;\n\nexport const mapChildren = (children) => {\n  return (\n    children.map(child => {\n      if (typeof child === \"string\" || typeof child === \"number\" || typeof child === \"boolean\") {\n        return createTextElement(String(child));\n      } else {\n        return child;\n      }\n    })\n  );\n};\n\nexport const createTextElement = (\n  text,\n) => {\n  return {\n    type: 'Text',\n    text,\n    render() {\n      return document.createTextNode(text);\n    }\n  };\n};\n\nexport const createHtmlElement = (\n  tag,\n  props = {},\n  ...children\n) => {\n  return {\n    tag,\n    type: 'HtmlElement',\n    props,\n    children,\n    render() {\n      /** @type HTMLElement */\n      const container = document.createElement(tag);\n      for (const child of children) {\n        if (child) {\n          container.appendChild(child.render());\n        }\n      }\n      Object.keys(props).forEach(key => {\n        if (key === 'ref') {\n          props[key].current = container;\n        } else if (key.startsWith('on')) {\n          container.addEventListener(key.slice(2).toLowerCase(), props[key]);\n        } else {\n          container.setAttribute(key, props[key]);\n        }\n      });\n      return container;\n    },\n  }\n};\n\nexport const createComponentElement = (\n  renderFunction,\n  props = {},\n  ...children\n) => {\n  return {\n    type: 'ComponentElement',\n    props,\n    slots: [],\n    effects: [],\n    children: mapChildren(children),\n    render() {\n      let oldCurrentComponent = currentComponent;\n      currentSlot = 0;\n      currentComponent = this;\n      const vdom = renderFunction(props);\n\n      let result;\n      try {\n        result = vdom.render();\n      } finally {\n        this.effects.forEach((e) => window.requestIdleCallback(e));\n        currentComponent = oldCurrentComponent;\n      }\n      return result;\n    },\n    useSlot() {\n      const slotIndex = currentSlot++;\n\n      if (slotIndex >= this.slots.length) {\n        this.slots[slotIndex] = undefined;\n      }\n\n      return {\n        slot: this.slots[slotIndex],\n        setSlot: (v) => {\n          this.slots[slotIndex] = v;\n        },\n      };\n    },\n  };\n};\n\nexport const useRef = (v) => {\n  const { slot, setSlot } = currentComponent.useSlot();\n  if (slot === undefined) {\n    const ref = { current: v };\n    setSlot(ref);\n    return ref;\n  }\n  return slot;\n};\n\nexport const useEffect = (hook, deps) => {\n  currentComponent.effects.push(hook);\n};\n"],"names":["currentComponent","currentSlot","h","tag","props","children","createHtmlElement","mapChildren","createComponentElement","map","child","createTextElement","String","text","type","render","document","createTextNode","container","createElement","appendChild","Object","keys","forEach","key","current","startsWith","addEventListener","slice","toLowerCase","setAttribute","renderFunction","slots","effects","oldCurrentComponent","this","vdom","result","e","window","requestIdleCallback","useSlot","slotIndex","length","undefined","slot","setSlot","v","useRef","ref","useEffect","hook","deps","push"],"mappings":"AAAA,IAAIA,EACAC,EAAc,QAcLC,EAZgB,CAC3BC,EACAC,EAAQ,MACLC,IAEgB,iBAARF,EACFG,EAAkBH,EAAKC,KAAUG,EAAYF,IAE7CG,EAAuBL,EAAKC,KAAUG,EAAYF,IAMhDE,EAAeF,GAExBA,EAASI,IAAIC,GACU,iBAAVA,GAAuC,iBAAVA,GAAuC,kBAAVA,EAC5DC,EAAkBC,OAAOF,IAEzBA,GAMFC,EACXE,IAEO,CACLC,KAAM,OACND,KAAAA,EACAE,OAAM,IACGC,SAASC,eAAeJ,KAKxBP,EAAoB,CAC/BH,EACAC,EAAQ,MACLC,KAEI,CACLF,IAAAA,EACAW,KAAM,cACNV,MAAAA,EACAC,SAAAA,EACAU,SAEE,MAAMG,EAAYF,SAASG,cAAchB,GACzC,IAAK,MAAMO,KAASL,EACdK,GACFQ,EAAUE,YAAYV,EAAMK,UAYhC,OATAM,OAAOC,KAAKlB,GAAOmB,QAAQC,IACb,QAARA,EACFpB,EAAMoB,GAAKC,QAAUP,EACZM,EAAIE,WAAW,MACxBR,EAAUS,iBAAiBH,EAAII,MAAM,GAAGC,cAAezB,EAAMoB,IAE7DN,EAAUY,aAAaN,EAAKpB,EAAMoB,MAG/BN,KAKAV,EAAyB,CACpCuB,EACA3B,EAAQ,MACLC,KAEI,CACLS,KAAM,mBACNV,MAAAA,EACA4B,MAAO,GACPC,QAAS,GACT5B,SAAUE,EAAYF,GACtBU,SACE,IAAImB,EAAsBlC,EAC1BC,EAAc,EACdD,EAAmBmC,KACnB,MAAMC,EAAOL,EAAe3B,GAE5B,IAAIiC,EACJ,IACEA,EAASD,EAAKrB,SADhB,QAGEoB,KAAKF,QAAQV,QAASe,GAAMC,OAAOC,oBAAoBF,IACvDtC,EAAmBkC,EAErB,OAAOG,GAETI,UACE,MAAMC,EAAYzC,IAMlB,OAJIyC,GAAaP,KAAKH,MAAMW,SAC1BR,KAAKH,MAAMU,QAAaE,GAGnB,CACLC,KAAMV,KAAKH,MAAMU,GACjBI,QAAUC,IACRZ,KAAKH,MAAMU,GAAaK,OAOrBC,EAAUD,IACrB,MAAMF,KAAEA,EAAFC,QAAQA,GAAY9C,EAAiByC,UAC3C,QAAaG,IAATC,EAAoB,CACtB,MAAMI,EAAM,CAAExB,QAASsB,GAEvB,OADAD,EAAQG,GACDA,EAET,OAAOJ,GAGIK,EAAY,CAACC,EAAMC,KAC9BpD,EAAiBiC,QAAQoB,KAAKF"}