{"version":3,"file":"index.js","sources":["../src/little-h.js"],"sourcesContent":["let currentComponent = undefined;\nlet currentSlot = 0;\n\nexport const createElement = (\n  tag,\n  props = {},\n  ...children\n) => {\n  if (typeof tag === 'string') {\n    return createHtmlElement(tag, props, ...mapChildren(children));\n  } else {\n    return createComponentElement(tag, props, ...mapChildren(children));\n  }\n};\n\nexport const h = createElement;\n\nexport const mapChildren = (children) => {\n  return (\n    children.map(child => {\n      if (typeof child === \"string\" || typeof child === \"number\" || typeof child === \"boolean\") {\n        return createTextElement(String(child));\n      } else {\n        return child;\n      }\n    })\n  );\n};\n\nexport const createTextElement = (\n  text,\n) => {\n  return {\n    type: 'Text',\n    text,\n    render() {\n      return document.createTextNode(text);\n    }\n  };\n};\n\nexport const createHtmlElement = (\n  tag,\n  props = {},\n  ...children\n) => {\n  return {\n    tag,\n    type: 'HtmlElement',\n    props,\n    children,\n    render() {\n      /** @type HTMLElement */\n      const container = document.createElement(tag);\n      for (const child of children) {\n        if (child) {\n          container.appendChild(child.render());\n        }\n      }\n      Object.keys(props).forEach(key => {\n        if (key === 'ref') {\n          props[key].current = container;\n        } else if (key.startsWith('on')) {\n          container.addEventListener(key.slice(2).toLowerCase(), props[key]);\n        } else {\n          container.setAttribute(key, props[key]);\n        }\n      });\n      return container;\n    },\n  }\n};\n\nexport const createComponentElement = (\n  renderFunction,\n  props = {},\n  ...children\n) => {\n  return {\n    type: 'ComponentElement',\n    props,\n    slots: [],\n    effects: [],\n    children: mapChildren(children),\n    render() {\n      let oldCurrentComponent = currentComponent;\n      currentSlot = 0;\n      currentComponent = this;\n      const vdom = renderFunction(props);\n\n      let result;\n      try {\n        result = vdom.render();\n      } finally {\n        this.effects.forEach((e) => window.requestIdleCallback(e));\n        currentComponent = oldCurrentComponent;\n      }\n      return result;\n    },\n    useSlot() {\n      const slotIndex = currentSlot++;\n\n      if (slotIndex >= this.slots.length) {\n        this.slots[slotIndex] = undefined;\n      }\n\n      return {\n        slot: this.slots[slotIndex],\n        setSlot: (v) => {\n          this.slots[slotIndex] = v;\n        },\n      };\n    },\n  };\n};\n\nexport const useRef = (v) => {\n  const { slot, setSlot } = currentComponent.useSlot();\n  if (slot === undefined) {\n    const ref = { current: v };\n    setSlot(ref);\n    return ref;\n  }\n  return slot;\n};\n\nexport const useEffect = (hook, deps) => {\n  currentComponent.effects.push(hook);\n};\n"],"names":["currentComponent","undefined","currentSlot","mapChildren","children","map","child","createTextElement","String","text","type","render","document","createTextNode","createHtmlElement","tag","props","container","createElement","appendChild","Object","keys","forEach","key","current","startsWith","addEventListener","slice","toLowerCase","setAttribute","createComponentElement","renderFunction","slots","effects","oldCurrentComponent","this","result","vdom","e","window","requestIdleCallback","useSlot","slotIndex","length","slot","setSlot","v","_this","hook","deps","push","ref"],"mappings":"szBAAA,IAAIA,OAAmBC,EACnBC,EAAc,EAgBLC,EAAc,SAACC,GAC1B,OACEA,EAASC,IAAI,SAAAC,GACX,MAAqB,iBAAVA,GAAuC,iBAAVA,GAAuC,kBAAVA,EAC5DC,EAAkBC,OAAOF,IAEzBA,KAMFC,EAAoB,SAC/BE,GAEA,MAAO,CACLC,KAAM,OACND,KAAAA,EACAE,kBACE,OAAOC,SAASC,eAAeJ,MAKxBK,EAAoB,SAC/BC,EACAC,YAAAA,IAAAA,EAAQ,QACLZ,6BAEH,MAAO,CACLW,IAAAA,EACAL,KAAM,cACNM,MAAAA,EACAZ,SAAAA,EACAO,kBAGE,IADA,MAAMM,EAAYL,SAASM,cAAcH,OACrBX,kBAAU,KAAnBE,UACLA,GACFW,EAAUE,YAAYb,EAAMK,UAYhC,OATAS,OAAOC,KAAKL,GAAOM,QAAQ,SAAAC,GACb,QAARA,EACFP,EAAMO,GAAKC,QAAUP,EACZM,EAAIE,WAAW,MACxBR,EAAUS,iBAAiBH,EAAII,MAAM,GAAGC,cAAeZ,EAAMO,IAE7DN,EAAUY,aAAaN,EAAKP,EAAMO,MAG/BN,KAKAa,EAAyB,SACpCC,EACAf,GAGA,gBAHAA,IAAAA,EAAQ,IAGD,CACLN,KAAM,mBACNM,MAAAA,EACAgB,MAAO,GACPC,QAAS,GACT7B,SAAUD,8BACVQ,kBACE,IAAIuB,EAAsBlC,EAC1BE,EAAc,EACdF,EAAmBmC,KACnB,IAEIC,EAFEC,EAAON,EAAef,GAG5B,IACEoB,EAASC,EAAK1B,SADhB,QAGEwB,KAAKF,QAAQX,QAAQ,SAACgB,UAAMC,OAAOC,oBAAoBF,KACvDtC,EAAmBkC,EAErB,OAAOE,GAETK,8BACQC,EAAYxC,IAMlB,OAJIwC,GAAaP,KAAKH,MAAMW,SAC1BR,KAAKH,MAAMU,QAAazC,GAGnB,CACL2C,KAAMT,KAAKH,MAAMU,GACjBG,QAAS,SAACC,GACRC,EAAKf,MAAMU,GAAaI,iBA1GL,SAC3B/B,EACAC,YAAAA,IAAAA,EAAQ,QACLZ,6BAEH,MAAmB,iBAARW,EACFD,gBAAkBC,EAAKC,UAAUb,EAAYC,KAE7C0B,gBAAuBf,EAAKC,UAAUb,EAAYC,wBAmHpC,SAAC4C,EAAMC,GAC9BjD,EAAiBiC,QAAQiB,KAAKF,mBAXV,SAACF,GACrB,MAA0B9C,EAAiByC,UAAnCG,IAAAA,KACR,QAAa3C,IAAT2C,EAAoB,CACtB,IAAMO,EAAM,CAAE3B,QAASsB,GAEvB,OADAD,IAHYA,SAGJM,GACDA,EAET,OAAOP"}